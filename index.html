<!doctype html>
<html>
  <head>
    <title>Gamepad test!</title>
    <script>
		// Returns an array with the numbers of the active buttons as they are
		// displayed on the gamepad (i.e. indexed at 1)
		function getActiveButtons(gamepad) {
			var active = [];
			for (i = 0; i < gamepad.buttons.length; i++) {
				if (gamepad.buttons[i].pressed) {
					active.push(i+1);
				}
			}
			return active;
		}

		// Returns an array of boolean values indicating whether each button is
		// pressed or not
		function getButtonStatuses(gamepad) {
			var btnStatuses = [];
			gamepad.buttons.forEach( function(b) {
				btnStatuses.push(b.pressed)
			});
			return btnStatuses;
		}

		// Returns an array with the values of the gamepad's axes (-1 to 1)
		function getAxisStatuses(gamepad) {
			return gamepad.axes;
		}

		// Prints strings to the console with more easily human-readable
		// information regarding which buttons are pressed and which aren't
		function displayButtonStatuses(gamepad) {
			var i = 0;
	    	getButtonStatuses(gamepad).forEach( function(s) {
	    		if (s) {
	    			console.log("Button " + String(i+1) + " pressed.");
	    		}
	    		else {
	    			console.log("Button " + String(i+1) + " not pressed.");
	    		}
	    		i++;
	    	});
		}

		// Returns an object which mimics the Gamepad object's buttons and axes
		// arrays in order to create a deep copy of these attributes from the
		// Gamepad object passed to it
		function saveGP(gamepad) {
			var GamepadState = {
				buttons : [],
				axes : []
			};

			gamepad.buttons.forEach( function(b) {
				var GamepadButton = {
					pressed : b.pressed,
					value : b.value
				};
				GamepadState.buttons.push(
					GamepadButton
				);
			});

			gamepad.axes.forEach( function(a) {
				GamepadState.axes.push(a);
			});

			return GamepadState;
		}

		// Displays information on connected Gamepads in the HTML
		function displayInfo() {

			// Determine which Gamepads are connected, if any
			var activeGPs = [];
			navigator.getGamepads().forEach(function(g){
				if (g.connected) {
					activeGPs.push(g);
				}
			});

			// Display a notice based on the number of connected Gamepads
			if (activeGPs.length == 0) {
				document.getElementById("top").innerHTML = 
				"<h1>No Gamepads Detected.</h1><h3>If a Gamepad is connected," +
				" try pressing one of its buttons.</h3>";
			}
			else if (activeGPs.length == 1){
				document.getElementById("top").innerHTML = 
				"<h1>1 Gamepad Detected.</h1>";
			}
			else {
				document.getElementById("top").innerHTML = 
				"<h1>" + activeGPs.length + 
				" Gamepads Detected.</h1>";
			}

			// Clear the GPs div
			document.getElementById("GPs").innerHTML = "";

			// Populate the GPs div with a gamepad div for each connected
			// gamepad, containing information about that gamepad
			activeGPs.forEach( function(g){
				var msgPart1 = "<div class='gamepad' id='gp" +
				String(g.index) +
				"'>" +
				"<h2>Gamepad " +
				String(g.index) +
				"</h2> <strong>ID:</strong> " +
				g.id +
				"<br><strong>" +
				String(g.buttons.length) +
				"</strong> buttons<br><strong>" +
				String(g.axes.length) +
				"</strong> axes<br><strong>Mapping: </strong>";

				if (g.mapping == "") {
					document.getElementById("GPs").innerHTML += msgPart1 +
					"None</div>";
				}
				else {
					document.getElementById("GPs").innerHTML += msgPart1 +
					String(g.mapping) +
					"</div>";
				}
			});
		}

		// Listeners for Gamepads connecting and disconnecting

		window.addEventListener("gamepadconnected", function(e) {
			displayInfo();
		});

		window.addEventListener("gamepaddisconnected", function(e) {
			displayInfo()
		});

		displayInfo();

    </script>

    <style>
    #top {
    	text-align: center;
    }

    #GPs {
    	text-align: center;
    }

    .gamepad {
    	text-align: left;
    	background: #BFBFBF;
    	padding: 20px;
    	margin-bottom: 20px;

    	-moz-border-radius: 20px;
		-webkit-border-radius: 20px;
		border-radius: 20px;
    }

    .gamepad h2 {
    	margin: 0;
    }
    </style>

  </head>
  <body>
    <div id="top">
   	</div>
   	<div id="GPs">
   	</div>
  </body>
</html>
